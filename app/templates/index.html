<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>漂-しるし-</title>
  <link rel="stylesheet" href="{{ url_for('static', path='app.css') }}">
</head>

<body data-has-anon="{% if has_anon %}1{% else %}0{% endif %}">

  <canvas id="bgCanvas"></canvas>

  <video id="bgVideo" muted loop playsinline preload="auto" style="display:none">
    <source src="{{ url_for('static', path='ocean.mp4') }}" type="video/mp4" />
  </video>

  <audio
    id="bgAudio"
    src="{{ url_for('static', path='ocean_bgm.m4a') }}"
    preload="auto"
    loop
  ></audio>

  <div id="splash" aria-hidden="true">
    <div class="pixel-title">漂-しるし-</div>
  </div>

  <div id="app">
    <!-- Scene: nickname -->
    <section id="scene-nick" class="scene {% if not has_anon %}is-active{% endif %}">
      <div class="wrap">
        <div class="nick-stack">
          <span class="nick-text">まず、ニックネームを教えて。</span>

          <form id="nickForm" class="nick-form" action="/anon" method="post">
            <input
              id="nickInput"
              class="nick-input"
              name="nickname"
              maxlength="32"
              placeholder="なにか。"
              required
            />
          </form>

          <button class="nick-enter" type="submit" form="nickForm">
            👣砂浜を歩いてみる。
          </button>
        </div>
      </div>
    </section>

    <!-- Scene: walking -->
    <section id="scene-walk" class="scene">
      <div class="wrap">
        <div class="card center ghost">
          <div class="walk-text">砂浜を歩く……</div>
          <div class="walk-sub">ざく、ざく、ざく。</div>
        </div>
      </div>
    </section>

    <!-- Scene: choice -->
    <section id="scene-choice" class="scene {% if has_anon %}is-active{% endif %}">
      <div class="choice-stack" aria-label="選択">
        <button class="choice-line" id="chooseBottle" type="button">
          今日届いた瓶の手紙をひとつ読む。
        </button>

        <button class="choice-line" id="choosePen" type="button">
          瓶の手紙を書く。
        </button>

        <div class="choice-back" id="choiceBack" role="button" tabindex="0" aria-label="戻る">
          やっぱり戻る。
        </div>
      </div>
    </section>

    <!-- Scene: read -->
    <section id="scene-read" class="scene">
      <div class="read-stack">
        <div class="read-title">今日のボトル</div>

        <button class="read-action" id="takeLetter" type="button">
          手紙を手に取る
        </button>

        <div class="read-sub" id="backFromRead" role="button" tabindex="0">
          やっぱり戻る
        </div>
      </div>
    </section>

    <!-- Scene: write -->
    <section id="scene-write" class="scene">
      <div class="write-stack">
        <div class="write-title">ことばを、ひとつ。</div>
          
        <form action="/bottles" method="post" class="write-form">
          <div class="write-lines">
            <textarea
              name="content"
              class="write-input"
              rows="6"
              maxlength="90"
              placeholder=""
              required
            ></textarea>
          </div>
          <div class="write-count" id="writeCount">90</div>
          <button class="write-submit" type="submit">
            海に流す。
          </button>

        </form>
      </div>
    </section>
  </div>

  <div class="letter-overlay" id="letterOverlay" aria-hidden="true">
    <div class="letter-wrap">
      <img class="letter-img" src="{{ url_for('static', path='letter.png') }}" alt="手紙" />
      <div class="letter-text" id="letterText" aria-label="手紙の本文"></div>
      <div class="letter-meta" id="letterMeta"></div>
    </div>
  </div>

  <!-- ✅ JS 外だし（defer推奨） -->
  <script defer src="{{ url_for('static', path='app.js') }}"></script>
</body>
</html>